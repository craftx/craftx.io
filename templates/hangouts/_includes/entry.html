{#
 # Since this template can be included from:
 # - index page /hangouts
 # - entry page /hangouts/_entry
 # We need a way to know which one, so that we may act accordingly.
 #
 # Simplest way is to check for the total segments and:
 # - if > 1 
 # we can assume that we are not on the index page
 #
 # The title of the entry should behave as follows:
 # - if isOnEntryPage and isLoggedInAdmin : link to the CP entry edit URL
 # - if isOnEntryPage and not isLoggedInAdmin: display plain title
 # - if not isOnEntryPage : link to entry page URL
 #}

{% set isOnEntryPage = craft.app.request.segments|length > 1 %}
{% set isLoggedInAdmin = user.admin ?? false %}
{% set hasMeetingNotes = entry.hangoutNotes is not empty %}
{% set isUpcomingHangout = entry.hangoutDateTime > now %}

{% if isOnEntryPage %}
    {% if isLoggedInAdmin %}
        <h2 class="title is-3">
            <a href="{{ entry.editUrl }}">{{ entry.title }}</a>
        </h2>
    {% else %}
        <h2 class="title is-3">{{ entry.title }}</h2>
    {% endif %}
{% else %}
    <h2 class="title is-3">
        <a href="{{ entry.url }}">{{ entry.title }}</a>
    </h2>
{% endif %}

{% if isUpcomingHangout %}
    <p>
        <a href="{{ entry.hangoutLink }}" class="button is-info is-heavy" title="Hangout Link" target="blank">
            <span>Join → {{ entry.hangoutLink }}</span>
            <span class="icon">
                <i class="fa fa-link"></i>
            </span>
        </a>
    </p>
{% endif %}

<div class="hangout__summary">
    {% if isUpcomingHangout %}
        {{ entry.hangoutTopic }}
    {% else %}
        {{ hasMeetingNotes ? entry.hangoutNotes : entry.hangoutTopic }}
    {% endif %}
</div>

<h2 class="title is-3">Roster</h2>
<div class="hangout__people">
    <ul>
        {% set host = entry.hangoutHost.one() %}
        <li>
            {% if host.links[0]['website'] is not empty %}
                <a href="{{ host.links[0]['website'] }}">{{ host.firstName }} {{ host.lastName}}</a>
            {% else %}
                {{ host.firstName }} {{ host.lastName}}
            {% endif %}
            → Host
        </li>
        {% for presenter in entry.hangoutPresenters.all() %}
            <li>
                {% if presenter.links[0]['website'] is not empty %}
                    <a href="{{ presenter.links[0]['website'] }}">{{ presenter.firstName }} {{ presenter.lastName}}</a>
                {% else %}
                    {{ presenter.firstName }} {{ presenter.lastName}}
                {% endif %}
                → Presenter
            </li>
        {% endfor %}
    </ul>
</div>

<h2 class="title is-3">Date/Time (${timezone})</h2>
<div class="hangout__times">
    <table class="table is-bordered is-striped">
        <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Zone</th>
        </tr>
        {% for date in craft.hangouts.translateDate(entry.hangoutDateTime) %}
            <tr>
                <td>{{ date.format("j F, Y") }}</td>
                <td><strong>{{ date.format("g:i A") }}</strong> {{ date.format("l") }}</td>
                <td> <strong>({{ date.format("T") }})</strong> {{ date.format("e")|replace({"_": " "}) }}</td>
            </tr>
        {% endfor %}
    </table>
</div>
