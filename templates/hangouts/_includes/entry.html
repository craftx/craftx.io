{#
 # Since this template can be included from:
 # - index page /hangouts
 # - entry page /hangouts/_entry
 # We need a way to know which one, so that we may act accordingly.
 #
 # Simplest way is to check for the total segments and:
 # - if > 1 
 # we can assume that we are not on the index page
 #
 # The title of the entry should behave as follows:
 # - if isOnEntryPage and isLoggedInAdmin : link to the CP entry edit URL
 # - if isOnEntryPage and not isLoggedInAdmin: display plain title
 # - if not isOnEntryPage : link to entry page URL
 #}

{% set isOnEntryPage = craft.app.request.segments|length > 1 %}
{% set isLoggedInAdmin = user.admin ?? false %}
{% set hasMeetingNotes = entry.hangoutNotes is not empty %}
{% set isUpcomingHangout = entry.hangoutDateTime > now %}

<h2 class="title is-3">About</h2>
<div class="hangout__summary">
    {% if isUpcomingHangout %}
        {{ entry.hangoutTopic }}
    {% else %}
        {{ hasMeetingNotes ? entry.hangoutNotes : entry.hangoutTopic }}
    {% endif %}
</div>

<h2 class="title is-3">Roster</h2>
<div class="hangout__people">
    <ul>
        {% set host = entry.hangoutHost.one() %}
        <li>
            {% if host.primaryWebsite is not empty %}
                <a href="{{ host.primaryWebsite }}">{{ host.firstName }} {{ host.lastName}}</a>
            {% else %}
                {{ host.firstName }} {{ host.lastName}}
            {% endif %}
            → Host
        </li>
        {% for presenter in entry.hangoutPresenters.all() %}
            <li>
                {% if presenter.primaryWebsite is not empty %}
                    <a href="{{ presenter.primaryWebsite }}">{{ presenter.firstName }} {{ presenter.lastName}}</a>
                {% else %}
                    {{ presenter.firstName }} {{ presenter.lastName}}
                {% endif %}
                → Presenter
            </li>
        {% endfor %}
        {% for guest in entry.hangoutGuests.all() %}
            <li>
                {% if guest.primaryWebsite is not empty %}
                    <a href="{{ guest.primaryWebsite }}">{{ guest.firstName }} {{ guest.lastName}}</a>
                {% else %}
                    {{ guest.firstName }} {{ guest.lastName}}
                {% endif %}
                → Guest
            </li>
        {% endfor %}
    </ul>
</div>

<h2 class="title is-3">Date/Time</h2>
<template v-if="timezone">
    <h2 class="title is-5">
        <span class="icon">
            <i class="fa fa-bolt"></i>
        </span>
        <span>
            Highlighted row is my best guess at your timezone.
        </span>
    </h2>
</template>

<div class="hangout__times">
    <table class="table is-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Zone</th>
            </tr>
        </thead>
        <tbody>
            <template v-if="timezone" v-cloack>
                <tr class="is-selected">
                    <td>${date}</td>
                    <td>${time}</td>
                    <td>${zone}</td>
                </tr>
            </template>
            {% for date in craft.hangouts.translateDateTime(entry.hangoutDateTime) %}
                <tr>
                    <td>{{ date.format("j F Y") }}</td>
                    <td><strong>{{ date.format("g:i A") }}</strong> {{ date.format("l") }}</td>
                    <td> <strong>({{ date.format("T") }})</strong> {{ date.format("e")|replace({"_": " "}) }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
